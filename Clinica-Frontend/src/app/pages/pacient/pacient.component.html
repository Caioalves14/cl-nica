<div id="pacient-management">
  <div class="card">
    <p-tabView>
      <!-- Aba de Cadastro/Alteração/Exclusão de Pacientes -->
      <p-tabPanel header="Pacientes">
        <p-toast></p-toast>
        <p-table
          #dt
          [value]="pacients"
          dataKey="id"
          editMode="row"
          [tableStyle]="{ 'min-width': '50rem' }"
        >
          <ng-template pTemplate="header">
            <tr>
              <th>CPF</th>
              <th>Nome</th>
              <th>Idade</th>
              <th>Endereço</th>
              <th>Telefone</th>
              <th>Status</th>
              <th>Ação</th>
            </tr>
          </ng-template>
          <ng-template
            pTemplate="body"
            let-pacient
            let-editing="editing"
            let-ri="rowIndex"
          >
            <tr [pEditableRow]="pacient">
              <td>{{ pacient.cpf }}</td>
              <td>{{ pacient.name }}</td>
              <td>{{ pacient.age }}</td>
              <td>{{ pacient.address }}</td>
              <td>{{ pacient.phone }}</td>
              <td>{{ pacient.status }}</td>
              <td>
                <div
                  class="flex align-items-center justify-content-center gap-2"
                >
                  <button
                    *ngIf="!editing"
                    pButton
                    pRipple
                    type="button"
                    pInitEditableRow
                    icon="pi pi-pencil"
                    (click)="onRowEditInit(pacient)"
                    class="p-button-rounded p-button-text"
                  ></button>
                  <button
                    *ngIf="editing"
                    pButton
                    pRipple
                    type="button"
                    pSaveEditableRow
                    icon="pi pi-check"
                    (click)="onRowEditSave(pacient)"
                    class="p-button-rounded p-button-text p-button-success mr-2"
                  ></button>
                  <button
                    *ngIf="editing"
                    pButton
                    pRipple
                    type="button"
                    pCancelEditableRow
                    icon="pi pi-times"
                    (click)="onRowEditCancel(pacient, ri)"
                    class="p-button-rounded p-button-text p-button-danger"
                  ></button>
                </div>
              </td>
            </tr>
          </ng-template>
        </p-table>
      </p-tabPanel>

      <!-- Aba de Pacientes em Tratamento -->
      <p-tabPanel header="Pacientes em Tratamento">
        <p-table
          [value]="pacientsInTreatment"
          dataKey="id"
          [tableStyle]="{ 'min-width': '50rem' }"
        >
          <ng-template pTemplate="header">
            <tr>
              <th>CPF</th>
              <th>Nome</th>
              <th>Idade</th>
              <th>Endereço</th>
              <th>Telefone</th>
              <th>Status</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-pacient>
            <tr>
              <td>{{ pacient.cpf }}</td>
              <td>{{ pacient.name }}</td>
              <td>{{ pacient.age }}</td>
              <td>{{ pacient.address }}</td>
              <td>{{ pacient.phone }}</td>
              <td>{{ pacient.status }}</td>
            </tr>
          </ng-template>
        </p-table>
      </p-tabPanel>

      <!-- Aba de Prescrições Atrasadas -->
      <p-tabPanel header="Prescrições Atrasadas">
        <p-table
          [value]="latePrescriptions"
          dataKey="number"
          [tableStyle]="{ 'min-width': '60rem' }"
        >
          <ng-template pTemplate="header">
            <tr>
              <th>Nome do Paciente</th>
              <th>Doença</th>
              <th>Nome do Remédio</th>
              <th>Data Revisão</th>
              <th>Status</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-prescription>
            <tr>
              <td>{{ prescription.pacient.name }}</td>
              <td>{{ prescription.disease.name }}</td>
              <td>{{ prescription.medicationName }}</td>
              <td>{{ prescription.revisionDate | date }}</td>
              <td>
                <p-tag
                  [value]="prescription.status"
                  [severity]="getSeverity(prescription.status)"
                />
              </td>
            </tr>
          </ng-template>
        </p-table>
      </p-tabPanel>
    </p-tabView>
  </div>
</div>
